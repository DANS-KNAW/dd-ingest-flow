#!/usr/bin/env python3

import argparse
import os

import requests

def start_import(path, continue_previous, migration):
    r = requests.post('http://localhost:20300/imports', json={
        'batch': os.path.abspath(path),
        'continue': continue_previous,
        'migration': migration
    })

    print('Server responded: %s' % r.text)

parser = argparse.ArgumentParser(add_help=True)
subparsers = parser.add_subparsers(dest='command')
parser_import = subparsers.add_parser('start-import',
                                      help='start import of a batch of deposits')

parser_import.add_argument('batch',
                           metavar='<batch-directory>',
                           help='path to batch of deposits to import; the directory must be located inside the import area')
parser_import.add_argument('-c', '--continue',
                           action='store_true',
                           dest='continue_previous',
                           help='continue previously stopped batch (i.e. allow output directory to be non-empty)')
parser_import.add_argument('-m', '--migration',
                           action='store_true',
                           dest='migration',
                           default=True,
                           help='import as migrated datasets (default = True)')

parser_events = subparsers.add_parser('list-events',
                                      help='print events per deposit')
parser_events.add_argument('-b', '--batch',
                           dest='batch',
                           metavar='<batch>',
                           help='only events for this batch')
parser_events.add_argument('-d', '--deposit',
                           metavar='<uuid>',
                           dest='deposit_id',
                           help='only events for this deposit')

parser_status = subparsers.add_parser('get-status',
                                      help='print last event per deposit')
parser_status.add_argument('-b', '--batch',
                           dest='batch',
                           metavar='<batch>',
                           help='only status of this batch')
parser_status.add_argument('-d', '--deposit',
                           metavar='<uuid>',
                           dest='deposit_id',
                           help='only status of this deposit')

args = parser.parse_args()

if args.command == 'start-import':
    start_import(args.batch, args.continue_previous, args.migration)
# elif args.command == 'list-events':



